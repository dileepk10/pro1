pipeline{
    agent any
       tools{
           maven "maven3.8.6"
       }
       
      stages{
          stage('CheckOutCode'){
              steps{
                  git branch: 'development', credentialsId: 'a520bd43-b2f8-48fa-998f-305bc935c635', url: 'https://github.com/dileepk10/pro1.git'
              }
          }
          stage('Build'){
              steps{
                  sh 'mvn clean package'
              }
          }
          stage('SonarQubeReport'){
              steps{
                  sh 'mvn clean sonar:sonar'
              }
          }
          stage('UploadIntoNexus'){
              steps{
                  sh 'mvn clean deploy'
              }
          }
	            stage('DeployIntoTomcat'){
              steps{
                  sshagent(['39756fb0-0dce-43f0-882b-c50509845a9c']) {
                   sh 'scp -o StrictHostKeyChecking=no target/maven-web-application.war ec2-user@13.233.224.147:/opt/apache-tomcat-9.0.68/webapps/'
}
                  
              }
          }
}
post{
          always{
              emailext body: '''Build is deployment

             Regards
             Dileep''', subject: 'Build is over!', to: 'kumark10kumar@gmail.com'
          }
          success{
              emailext body: '''Build is deployment is successful

             Regards
             Dileep''', subject: 'Build is over!', to: 'kumark10kumar@gmail.com'
          }
          failure{
              emailext body: '''Build is deployment is failed

             Regards
             Dileep''', subject: 'Build is over!', to: 'kumark10kumar@gmail.com'
          }
      }
}
